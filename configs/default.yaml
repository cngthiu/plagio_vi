# configs/default.yaml
io:
  keep_tables: true
  ignore_sections:
    - "Tài liệu tham khảo"
    - "Lời cảm ơn"
    - "Lời cam đoan"
    - "Mục lục"
  export:
    json: true
    html_report: true
    out_dir: "outputs"

preprocess:
  accent_dual_versions: true
  abbreviations_expand: true
  synonyms_expand: true
  remove_boilerplate: true
  remove_stop_phrases: true
  lowercase: true
  unicode_normalize: "NFC"
  strip_punctuation: false
  strip_zero_width: true
  mask_numbers: true

dictionary_paths:
  stop_phrases: "data/dictionaries/stop_phrases_vi.txt"
  synonyms: "data/dictionaries/synonyms_vi.tsv"
  abbreviations: "data/dictionaries/abbreviations.tsv"
  gazetteer: "data/dictionaries/gazetteer_entities.tsv"
  boilerplate: "data/patterns/boilerplate_vi.txt"
  section_headers: "data/patterns/section_headers.txt"

chunking:
  mode: "paragraph" # "sentence" hoặc "paragraph" để giữ ngữ cảnh theo đoạn/heading
  size_tokens: 260
  overlap: 50
  max_seq_len_bi: 256
  max_seq_len_cross: 384

# [UPDATE] Các tham số Alignment (trước đây hardcode)
alignment:
  gap_merge: 5 # Khoảng cách tối đa để gộp 2 span (sw_align)
  min_len_local: 20 # Độ dài tối thiểu của span (sw_align)
  iou_threshold: 0.6 # Ngưỡng NMS
  semantic_enabled: true # Bắt paraphrase mạnh bằng sentence-embedding
  semantic_threshold: 0.78
  semantic_topk: 3
  semantic_min_coverage: 0.15

# [UPDATE] Các tham số Report
report:
  snippet_context_chars: 40 # Số ký tự ngữ cảnh trước/sau highlight

bm25:
  k1: 1.2
  b: 0.75
  topk: 30

simhash:
  ngram: 7
  window: 10
  topk: 50

ann:
  topk_recall: 50
  topk_rerank: 10
  force_brute_force_threshold: 5000 # [UPDATE] Nếu số chunk < 5000, dùng brute-force

ranking_weights:
  alpha: 0.55
  beta: 0.25
  gamma: 0.15
  delta: 0.05

thresholds:
  high: 0.84
  medium: 0.74
  low: 0.64

gating:
  ce_min_bi: 0.25
  ce_max_bi: 0.92
  prefilter_bi: 0.30
  prefilter_lex: 0.20

domain_dicts:
  enabled: true
  paths:
    - "data/dictionaries/domain/it_terms.tsv"
    - "data/dictionaries/domain/economics_terms.tsv"
    - "data/dictionaries/domain/ee_terms.tsv"

domain_boilerplate:
  enabled: true
  paths:
    - "data/patterns/boilerplate_it.txt"
    - "data/patterns/boilerplate_economics.txt"
    - "data/patterns/boilerplate_ee.txt"
    - "data/patterns/boilerplate_law_vi.txt"

penalties:
  lex_boilerplate_lambda: 0.5
  stopphrase_lambda: 0.2
  citation_lambda: 0.15
  citation_patterns:
    - "\\[[0-9]{1,3}\\]"
    - "\\([0-9]{4}\\)"
    - "theo .*?\\("
  min_span_chars: 24
  min_small_spans: 2
  small_span_chars: 12
